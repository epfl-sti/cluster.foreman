# -*- mode: sh[bash]; -*-
# Run foreman-installer, mostly.
#
# Invoked inside a Docker container by "dockerer build"
# As a prelude, restore from backup if any (if $tarname is set).
# As a postlude, fix up whatever needs be.

echo "Personalizing Docker container..."

cp /cluster.foreman/foreman-installer-answers.yaml /etc/foreman/

if [ -n "$tarname" ]; then
    # Untar the contents of all volumes.
    # Keep this list in sync with Dockerfile and dockerer
    tar xvf /cluster.foreman/$tarname \
        var/lib/puppet/ \
        var/lib/postgresql/ \
        var/lib/dhcp/ \
        var/cache/bind/ \
        etc/foreman/foreman-installer-answers.yaml || true
fi

foreman-installer || bash

echo 'listen-on { any; };' >>/etc/bind/named.conf.options
